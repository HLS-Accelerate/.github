<aura:component implements="flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes" access="global" controller="DE_RY_KnowledgeArticle_Flow">
    
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    
    <aura:attribute name="cardTitle" type="string"></aura:attribute>
    <aura:attribute name="record" type="Object"/>
    <aura:attribute name="simpleRecord" type="Object"/>
    <aura:attribute name="recordError" type="String"/>
    <aura:attribute name="isCommunity" type="boolean" default="true"></aura:attribute>
    
    <aura:attribute name="flow" type="Aura.Component" access="GLOBAL"/>
    
    <aura:attribute name="selectedFlowApiNameParent" type="string"></aura:attribute>
    <aura:handler name="change" value="{!v.selectedFlowApiNameParent}" action="{!c.onFlowChange}"/>
    
    <force:recordData aura:id="recordLoader"
                      fields="Guided_Flow__c,PublishStatus"
                      recordId="{!v.recordId}"
                      targetFields="{!v.simpleRecord}"
                      targetError="{!v.recordError}"
                      recordUpdated="{!c.handleRecordUpdated}"
                      mode="VIEW"
                      />
    
    <aura:if isTrue="{!or(v.isCommunity &amp;&amp; not(empty(v.simpleRecord.Guided_Flow__c)), !v.isCommunity)}">
        <lightning:card title="{!v.cardTitle}">
            <aura:set attribute="actions">
                <aura:if isTrue="{!v.simpleRecord.Guided_Flow__c &amp;&amp; !v.isCommunity &amp;&amp; v.simpleRecord.PublishStatus == 'Draft'}">
                    <lightning:buttonGroup>
                        <lightning:button label="Detach Flow" onclick="{!c.onDetachFlow}"/>
                    </lightning:buttonGroup>
                </aura:if>
            </aura:set>
            <aura:if isTrue="{!!v.isCommunity}">
                <c:DE_RY_KnowledgeArticle_Flow_Search aura:id="flowSearch"
                                                      entityId="{!v.recordId}"
                                                      selectedFlowApiName="{!v.selectedFlowApiNameParent}"
                                                      currentFlowApiName="{#v.simpleRecord.Guided_Flow__c}">
                </c:DE_RY_KnowledgeArticle_Flow_Search>
            </aura:if>
            <aura:if isTrue="{!or(v.simpleRecord.Guided_Flow__c, v.selectedFlowApiNameParent)}">
                <aura:if isTrue="{!v.simpleRecord.PublishStatus == 'Draft' &amp;&amp; !v.isCommunity}">
                    <div class="slds-section slds-is-open slds-p-horizontal_small">
                        <h3 class="slds-section__title">
                            <button aria-controls="expando-unique-id" aria-expanded="true" class="slds-button slds-section__title-action">
                                <span class="slds-truncate" title="Section Title">Flow Preview</span>
                            </button>
                        </h3>
                    </div>
                </aura:if>
                {!v.flow}
                <aura:set attribute="else">
                    <div class="slds-illustration slds-illustration_small slds-p-top_small" aria-hidden="true">
                        <img src="/img/chatter/OpenRoad.svg" class="slds-illustration__svg" alt=""/>
                        <div class="slds-text-color_weak">
                            <h3 class="slds-text-heading_medium">Attach a flow to the knowledge article.</h3>
                            <aura:if isTrue="{!v.simpleRecord.PublishStatus != 'Draft'}">
                                <p class="slds-text-body_regular">Please edit the article as draft to attach a flow.</p>
                            </aura:if>
                            <aura:if isTrue="{!v.simpleRecord.PublishStatus == 'Draft'}">
                                <p class="slds-text-body_regular">Please select a flow to get started.</p>
                            </aura:if>
                            <!--<lightning:button label="Attach Flow" variant="brand" class="slds-m-top_small" onclick="{!c.onAttachFlow}" disabled="{!v.simpleRecord.PublishStatus != 'Draft'}"/>-->
                        </div>
                    </div>
                </aura:set>
            </aura:if>
        </lightning:card>
    </aura:if>
    
    
</aura:component>